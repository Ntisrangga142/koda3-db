CREATE TABLE "Account" (
  "ID" INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "Email" VARCHAR(255) NOT NULL UNIQUE,
  "Password" VARCHAR(255) NOT NULL
);

CREATE TABLE "Directors" (
  "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Name" VARCHAR(255) NOT NULL
);

CREATE TABLE "Genres" (
  "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Name" VARCHAR(255) NOT NULL
);

CREATE TABLE "Actors" (
  "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Name" VARCHAR(255) NOT NULL
);

CREATE TABLE "Cinema" (
  "ID" INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "Name" VARCHAR(255) NOT NULL,
  "Price" INTEGER NOT NULL
);

CREATE TABLE "Location" (
  "ID" INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "Name" VARCHAR(255) NOT NULL
);

CREATE TABLE "Time" (
  "ID" INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "Time" TIME NOT NULL
);

CREATE TABLE "Seat" (
  "ID" VARCHAR(255) PRIMARY KEY
);

CREATE TABLE "PaymentMethod" (
  "ID" INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "Name" VARCHAR(255) NOT NULL
);

-- Users butuh Account
CREATE TABLE "Users" (
  "ID" INTEGER PRIMARY KEY,
  "ProfileImg" VARCHAR(255),
  "FirstName" VARCHAR(255) NOT NULL,
  "LastName" VARCHAR(255) NOT NULL,
  "Phone" VARCHAR(255) UNIQUE NOT NULL,
  "Point" INTEGER DEFAULT 0,
  CONSTRAINT "FK_Account_User" FOREIGN KEY ("ID") REFERENCES "Account" ("ID") ON DELETE CASCADE
);

CREATE TABLE "Movies" (
  "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Title" VARCHAR(255) NOT NULL UNIQUE,
  "Poster" VARCHAR(255) NOT NULL,
  "Backdrop" VARCHAR(255) NOT NULL,
  "Release_Date" DATE NOT NULL,
  "Duration" INTEGER NOT NULL,
  "Synopsis" VARCHAR(255) NOT NULL,
  "Rating" FLOAT DEFAULT 0.0,
  "ID_Director" INTEGER NOT NULL,
  CONSTRAINT "FK_ID_Director" FOREIGN KEY ("ID_Director") REFERENCES "Directors" ("ID") ON DELETE CASCADE
);

CREATE TABLE "Movies_Genres" (
  "ID_Movie" INTEGER NOT NULL,
  "ID_Genre" INTEGER NOT NULL,
  CONSTRAINT "Movies_Genres_PK" PRIMARY KEY ("ID_Movie", "ID_Genre"),
  CONSTRAINT "FK_ID_Movie_Genres" FOREIGN KEY ("ID_Movie") REFERENCES "Movies" ("ID") ON DELETE CASCADE,
  CONSTRAINT "FK_ID_Genre_Movie" FOREIGN KEY ("ID_Genre") REFERENCES "Genres" ("ID") ON DELETE CASCADE
);

CREATE TABLE "Movies_Actors" (
  "ID_Movie" INTEGER NOT NULL,
  "ID_Actor" INTEGER NOT NULL,
  CONSTRAINT "Movies_Actors_PK" PRIMARY KEY ("ID_Movie", "ID_Actor"),
  CONSTRAINT "FK_ID_Movie_Actor" FOREIGN KEY ("ID_Movie") REFERENCES "Movies" ("ID") ON DELETE CASCADE,
  CONSTRAINT "FK_ID_Actor_Movie" FOREIGN KEY ("ID_Actor") REFERENCES "Actors" ("ID") ON DELETE CASCADE
);

CREATE TABLE "NowShowing" (
  "ID" INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "Date" DATE NOT NULL,
  "ID_Movie" INTEGER NOT NULL,
  "ID_Cinema" INTEGER NOT NULL,
  "ID_Location" INTEGER NOT NULL,
  "ID_Time" INTEGER NOT NULL,
  CONSTRAINT "FK_ID_Movie_Showing" FOREIGN KEY ("ID_Movie") REFERENCES "Movies" ("ID") ON DELETE CASCADE,
  CONSTRAINT "FK_ID_Cinema" FOREIGN KEY ("ID_Cinema") REFERENCES "Cinema" ("ID") ON DELETE CASCADE,
  CONSTRAINT "FK_ID_Location" FOREIGN KEY ("ID_Location") REFERENCES "Location" ("ID") ON DELETE CASCADE,
  CONSTRAINT "FK_ID_Time" FOREIGN KEY ("ID_Time") REFERENCES "Time" ("ID") ON DELETE CASCADE
);

CREATE TABLE "Orders" (
  "ID" INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "isPaid" BOOLEAN,
  "Total_Price" INTEGER NOT NULL,
  "QRCode" VARCHAR(255) NOT NULL,
  "Name" VARCHAR(255) NOT NULL,
  "Email" VARCHAR(255) NOT NULL,
  "Phone" VARCHAR(255) NOT NULL,
  "ID_NowShowing" INTEGER NOT NULL,
  "ID_PaymentMethod" INTEGER NOT NULL,
  "ID_User" INTEGER NOT NULL,
  CONSTRAINT "FK_ID_Showing" FOREIGN KEY ("ID_NowShowing") REFERENCES "NowShowing" ("ID") ON DELETE CASCADE,
  CONSTRAINT "FK_ID_Payment_Method" FOREIGN KEY ("ID_PaymentMethod") REFERENCES "PaymentMethod" ("ID") ON DELETE CASCADE,
  CONSTRAINT "FK_ID_User_Order" FOREIGN KEY ("ID_User") REFERENCES "Users" ("ID") ON DELETE CASCADE
);

CREATE TABLE "OrderDetails" (
  "ID_Order" INTEGER NOT NULL,
  "ID_Seat" VARCHAR(255) NOT NULL,
  CONSTRAINT "OrderDetails_PK" PRIMARY KEY ("ID_Order", "ID_Seat"),
  CONSTRAINT "FK_ID_Order_Details" FOREIGN KEY ("ID_Order") REFERENCES "Orders" ("ID") ON DELETE CASCADE,
  CONSTRAINT "FK_ID_Seat_Details" FOREIGN KEY ("ID_Seat") REFERENCES "Seat" ("ID") ON DELETE CASCADE
);
